{% extends 'base.html.twig' %}

{% block body %}

    <div class="mb-5 border-b border-white/5 pb-5">
        {% include '_partials/paginator.html.twig'
            with { 'paginator_id': 'paginator-header',
            'prev_path': path('app_search_index', { 'page': page - 1, 'query': query }),
            'next_path': path('app_search_index', { 'page': page + 1, 'query': query }) } %}
    </div>

    <turbo-frame id="search-result" data-turbo-action="advance"
                 class="transition duration-500 ease-in-out aria-busy:blur-[5px]">

        <div class="">
            <form class="max-w-xl mx-auto flex justify-center">
                <div class="mb-5">
                    <input type="text" id="text"
                           name="query" value=""
                           class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base
                            focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body"
                           placeholder="{{ query|default(('search.search')|trans) }}" required/>
                </div>

                <div>
                    <button type="submit"
                            class=" text-white bg-pink box-border border border-transparent hover:bg-pink-700 focus:ring-4
                            focus:ring-offset-pink-200 cursor-pointer shadow-xs font-medium leading-5 rounded-base text-sm ms-2 px-5 py-2.5 focus:outline-none">
                        {{ 'search.submit'|trans }}
                    </button>
                </div>
            </form>


            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 font-mono">
                {# @var movie \App\Dto\MovieResultDto #}
                {% for movie in results.results %}
                    <a href="{{ path('app_movie', { 'id': movie.id, 'slug': movie.title|slug|lower }) }}"
                       data-turbo-frame="_top">
                        <div
                            class="relative group rounded overflow-hidden shadow-sm border border-gray-700 cursor-pointer">
                            <div class="w-full overflow-hidden aspect-2/3 bg-gray-800 relative">
                                {% if movie.posterPath is null %}
                                    <img src="{{ asset('images/no-poster-placeholder.png') }}" alt=""
                                         class="opacity-40 ">
                                {% else %}
                                    <img
                                        src="https://image.tmdb.org/t/p/w500/{{ movie.posterPath }}"
                                        alt="Smooth load"
                                        loading="lazy"
                                        data-controller="image-loader"
                                        data-action="load->image-loader#reveal"
                                        class="opacity-0 transition-all ease-in-out w-full h-full object-cover transform duration-500 hover:scale-120 hover:rotate-[5deg] {{ movie.adult ? 'blur-[3px]' }}"
                                    >
                                {% endif %}


                                <div
                                    class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition inset-shadow-sm inset-shadow-gray-900/50"></div>

                            </div>

                            <div>
                                <div
                                    class="font-mono text-xl pb-2 my-2 mx-2 text-center font-bold border-b border-b-gray-700 ">
                                    {{ movie.title }}
                                </div>

                                <div class="mb-3 px-2">
                                    {% if movie.voteCount > 0 %}
                                        <div class="text-nowrap text-center dark:text-pink-400 font-bold">
                                            TMDB Rating: {{ movie.voteAverage|round(1) }}
                                        </div>
                                    {% endif %}

                                    <div class="text-center font-bold">{{ 'movie.release_date'|trans }}: <span
                                            class="text-nowrap">{{ movie.releaseDate|date('d-m-Y') }}</span></div>

                                    <div class="text-center">{{ movie.genres|map(g => g|trans)|join(', ') }}</div>
                                </div>
                            </div>

                        </div>

                    </a>
                {% endfor %}
            </div>
        </div>

        <turbo-stream action="replace" target="paginator-header">
            <template>
                {% include '_partials/paginator.html.twig'
                    with { 'paginator_id': 'paginator-header',
                    'prev_path': path('app_search_index', { 'page': page - 1, 'query': query }),
                    'next_path': path('app_search_index', { 'page': page + 1, 'query': query }) } %}
            </template>
        </turbo-stream>

        <turbo-stream action="replace" target="paginator-footer">
            <template>
                {% include '_partials/paginator.html.twig'
                    with { 'paginator_id': 'paginator-footer',
                    'prev_path': path('app_search_index', { 'page': page - 1, 'query': query }),
                    'next_path': path('app_search_index', { 'page': page + 1, 'query': query }) } %}
            </template>
        </turbo-stream>

    </turbo-frame>

    <div class="mt-5 border-t border-white/5 pt-5">
        {% include '_partials/paginator.html.twig'
            with { 'paginator_id': 'paginator-footer',
            'prev_path': path('app_search_index', { 'page': page - 1, 'query': query }),
            'next_path': path('app_search_index', { 'page': page + 1, 'query': query }) } %}
    </div>

{% endblock %}
